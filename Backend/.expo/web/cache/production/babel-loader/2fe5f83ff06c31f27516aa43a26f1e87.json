{"ast":null,"code":"var parseKeys=require('parse-asn1');var randomBytes=require('randombytes');var createHash=require('create-hash');var mgf=require('./mgf');var xor=require('./xor');var BN=require('bn.js');var withPublic=require('./withPublic');var crt=require('browserify-rsa');var Buffer=require('safe-buffer').Buffer;module.exports=function publicEncrypt(publicKey,msg,reverse){var padding;if(publicKey.padding){padding=publicKey.padding;}else if(reverse){padding=1;}else{padding=4;}var key=parseKeys(publicKey);var paddedMsg;if(padding===4){paddedMsg=oaep(key,msg);}else if(padding===1){paddedMsg=pkcs1(key,msg,reverse);}else if(padding===3){paddedMsg=new BN(msg);if(paddedMsg.cmp(key.modulus)>=0){throw new Error('data too long for modulus');}}else{throw new Error('unknown padding');}if(reverse){return crt(paddedMsg,key);}else{return withPublic(paddedMsg,key);}};function oaep(key,msg){var k=key.modulus.byteLength();var mLen=msg.length;var iHash=createHash('sha1').update(Buffer.alloc(0)).digest();var hLen=iHash.length;var hLen2=2*hLen;if(mLen>k-hLen2-2){throw new Error('message too long');}var ps=Buffer.alloc(k-mLen-hLen2-2);var dblen=k-hLen-1;var seed=randomBytes(hLen);var maskedDb=xor(Buffer.concat([iHash,ps,Buffer.alloc(1,1),msg],dblen),mgf(seed,dblen));var maskedSeed=xor(seed,mgf(maskedDb,hLen));return new BN(Buffer.concat([Buffer.alloc(1),maskedSeed,maskedDb],k));}function pkcs1(key,msg,reverse){var mLen=msg.length;var k=key.modulus.byteLength();if(mLen>k-11){throw new Error('message too long');}var ps;if(reverse){ps=Buffer.alloc(k-mLen-3,0xff);}else{ps=nonZero(k-mLen-3);}return new BN(Buffer.concat([Buffer.from([0,reverse?1:2]),ps,Buffer.alloc(1),msg],k));}function nonZero(len){var out=Buffer.allocUnsafe(len);var i=0;var cache=randomBytes(len*2);var cur=0;var num;while(i<len){if(cur===cache.length){cache=randomBytes(len*2);cur=0;}num=cache[cur++];if(num){out[i++]=num;}}return out;}","map":{"version":3,"names":["parseKeys","require","randomBytes","createHash","mgf","xor","BN","withPublic","crt","Buffer","module","exports","publicEncrypt","publicKey","msg","reverse","padding","key","paddedMsg","oaep","pkcs1","cmp","modulus","Error","k","byteLength","mLen","length","iHash","update","alloc","digest","hLen","hLen2","ps","dblen","seed","maskedDb","concat","maskedSeed","nonZero","from","len","out","allocUnsafe","i","cache","cur","num"],"sources":["/usr/local/lib/node_modules/expo-cli/node_modules/public-encrypt/publicEncrypt.js"],"sourcesContent":["var parseKeys = require('parse-asn1')\nvar randomBytes = require('randombytes')\nvar createHash = require('create-hash')\nvar mgf = require('./mgf')\nvar xor = require('./xor')\nvar BN = require('bn.js')\nvar withPublic = require('./withPublic')\nvar crt = require('browserify-rsa')\nvar Buffer = require('safe-buffer').Buffer\n\nmodule.exports = function publicEncrypt (publicKey, msg, reverse) {\n  var padding\n  if (publicKey.padding) {\n    padding = publicKey.padding\n  } else if (reverse) {\n    padding = 1\n  } else {\n    padding = 4\n  }\n  var key = parseKeys(publicKey)\n  var paddedMsg\n  if (padding === 4) {\n    paddedMsg = oaep(key, msg)\n  } else if (padding === 1) {\n    paddedMsg = pkcs1(key, msg, reverse)\n  } else if (padding === 3) {\n    paddedMsg = new BN(msg)\n    if (paddedMsg.cmp(key.modulus) >= 0) {\n      throw new Error('data too long for modulus')\n    }\n  } else {\n    throw new Error('unknown padding')\n  }\n  if (reverse) {\n    return crt(paddedMsg, key)\n  } else {\n    return withPublic(paddedMsg, key)\n  }\n}\n\nfunction oaep (key, msg) {\n  var k = key.modulus.byteLength()\n  var mLen = msg.length\n  var iHash = createHash('sha1').update(Buffer.alloc(0)).digest()\n  var hLen = iHash.length\n  var hLen2 = 2 * hLen\n  if (mLen > k - hLen2 - 2) {\n    throw new Error('message too long')\n  }\n  var ps = Buffer.alloc(k - mLen - hLen2 - 2)\n  var dblen = k - hLen - 1\n  var seed = randomBytes(hLen)\n  var maskedDb = xor(Buffer.concat([iHash, ps, Buffer.alloc(1, 1), msg], dblen), mgf(seed, dblen))\n  var maskedSeed = xor(seed, mgf(maskedDb, hLen))\n  return new BN(Buffer.concat([Buffer.alloc(1), maskedSeed, maskedDb], k))\n}\nfunction pkcs1 (key, msg, reverse) {\n  var mLen = msg.length\n  var k = key.modulus.byteLength()\n  if (mLen > k - 11) {\n    throw new Error('message too long')\n  }\n  var ps\n  if (reverse) {\n    ps = Buffer.alloc(k - mLen - 3, 0xff)\n  } else {\n    ps = nonZero(k - mLen - 3)\n  }\n  return new BN(Buffer.concat([Buffer.from([0, reverse ? 1 : 2]), ps, Buffer.alloc(1), msg], k))\n}\nfunction nonZero (len) {\n  var out = Buffer.allocUnsafe(len)\n  var i = 0\n  var cache = randomBytes(len * 2)\n  var cur = 0\n  var num\n  while (i < len) {\n    if (cur === cache.length) {\n      cache = randomBytes(len * 2)\n      cur = 0\n    }\n    num = cache[cur++]\n    if (num) {\n      out[i++] = num\n    }\n  }\n  return out\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}